{% extends "base.html" %}

{% block title %}Dashboard â€“ ResumeFit{% endblock %}

{% block content %}
<div class="py-4">

  <h1 class="mb-4">Welcome, {{ current_user.username }} ğŸ‘‹</h1>

  {% if latest %}
    <span class="badge bg-success mb-3">âœ… Resume uploaded</span>
  {% else %}
    <span class="badge bg-danger mb-3">âŒ No resume uploaded</span>
  {% endif %}

  <div class="mb-4 d-flex flex-wrap gap-2">
    <a class="btn btn-primary" href="{{ url_for('resume') }}">Upload / Update Resume</a>
    <a class="btn btn-success" href="{{ url_for('analyze') }}">Analyze a Job</a>
    <a class="btn btn-secondary" href="{{ url_for('logout') }}">Logout</a>
  </div>

  {% if latest %}
    <div class="card bg-black border-secondary">
      <div class="card-body">
        <h5 class="card-title">Your latest resume</h5>
        <p class="text-muted mb-2">
          {{ latest.original_filename }} Â· {{ latest.uploaded_at.strftime("%Y-%m-%d %H:%M") }}
        </p>
        <a class="btn btn-outline-light btn-sm" href="{{ url_for('resume') }}">View / Replace</a>
      </div>
    </div>
  {% else %}
    <p class="text-muted">No resume uploaded yet.</p>
  {% endif %}

  <h3 class="mt-5">Recent Analyses</h3>

  {% if recent %}
    <div class="list-group">
      {% for a in recent %}
        <a class="list-group-item list-group-item-action bg-black text-light border-secondary"
           href="{{ url_for('analysis_detail', analysis_id=a.id) }}">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ a.job_title or "Untitled Role" }}</strong>
              {% if a.company %}<span class="text-secondary"> @ {{ a.company }}</span>{% endif %}
            </div>
            <span class="badge
              {% if a.fit_label == 'Strong' %} bg-success
              {% elif a.fit_label == 'Medium' %} bg-warning text-dark
              {% else %} bg-danger
              {% endif %}">
              {{ a.fit_label }} Â· {{ a.fit_percentage }}%
            </span>
          </div>
          <div class="text-secondary small mt-1">{{ a.created_at.strftime("%Y-%m-%d %H:%M") }}</div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-secondary">No analyses yet.</p>
  {% endif %}

</div>
{% endblock %}
